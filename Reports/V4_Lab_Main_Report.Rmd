---
title: "V4 Lab Main Report"
author: "Szymon Talaga"
date: "03.05.2015"
output:
  pdf_document:
    latex_engine: xelatex
---

# Introduction
This is the main technical report of the V4 Lab Project. Its aim is twofold: 1) to see what is the level of economic/financial knowledge of Polish and Czech students and what are their attitudes in regard to economic liberalism/socialism; 2) to answer the main research problem posed in this project, that is whether there is a relationship between economic and financial knowledge, liberal/socialist attitudes and type of obtained education (EBMF, SSHA and STEM). Moreover we also check potential connections between knowledge and attitudes and some sociodemographics such as parental education and work experience.

We estimate level of the economic/financial knowledge by three means: 1) we investigate answer patterns to separate items (i.e. which are most diffcult etc.); 2) analyze what we call raw scores, that is sums of correct answers; 3) analyze what we call non-guessed answers, that is the number of correct answers that were not guessed. The last measure is based on an assumption that since the items were of true/false form then in the case when one does not know the correct answer the problem of answering such an item boils down to guessing with 50% chance of hit. Under this assumption it is easy to derive the number of questions that must have been answered correctly in a nonrandom fashion (that is respondent must have been quite certain that the answer he or she gives is the correct one). The number of correct answers may be computed using the following formula: $C = 2X - 2E - 1$, where C is the score, X is the actual number of correct answers given and E is the expected number of such answers (in this case this is a constant that equals 14.5, since there are 29 items with guessing chance of 50%).

Furthermore, KNOWLEDGE items of true/false form give us one more opportunity - it is easy to partition the item set into three subsets: 1) easy items (those with difficulty significantly below 0.5, what implies that on average respondents do know the correct answer and there is no need for guessing); 2) medium items (those around difficulty level of 0.5, what implies that on average respondents do not know the answer for sure and guess); 3) tricky items (those with difficulty significantly above 0.5, what implies that on average respondents have false beliefs about them).

Liberal/socialist economic attitudes are measured using the Liberalism-Socialism preferential scale that we constructed for the purpose of this project (more information about the scale can be found in the dedicated report). This scale ranges from -8 to 8 and negative score correspond to liberal pole of it and positive to socialist (the in-sample range is a bit narrower and spans from -7 to 7). However, the extreme values of -8 and 8 are not detectable in practice for some technical reasons which we will not discuss here. This problem is not important because no respondents have answer patterns that would lead to this kind of complication.

Parental education is assessed on the basis of three variables. The first two of them are father and mother education. These are categorical variables with four levels: 1) vocational education or lower; 2) high school; 3) higher education (defiend as BA or MA or equivalent); 4) PHD and above. The levels are slightly different from the original answer categories available in the questionnaire we used, where it was more detailed. This is due to the fact that some answers were very rare and we needed to group into wider categories.

The third variable we use to asses parental education is based on the previous ones. We call it the Ordinal Indicator of Joint Parental Education (OIJPE). It is constructed as follows: 1) recode father and mother education to integers ranging from 0 to 3 in such a manner that it preserves the education levels order; 2) add the recoded variables (it creates a variable ranging from 0 to 6). Of course (as the name suggests) OIJPE should not be treated as an interval or rational variable, but only as an ordinal one.

In the end we would like to introduce technical labels for some of the main variables that may appear throught the output tables in this report:

* **libsoc:** Liberalism-Socialism scale
* **ngknow:** Non-guessed knowledge score
* **knowraw:** Knowledge raw score
* **peduord:** Ordinal Indicator of the Joint Parental Education (OIJPE)

```{r, echo=FALSE, message=FALSE, warning=FALSE}
#####################
### MAIN ANALYSIS ###
#####################

### This script conducts the main analysis; it contains of between-groups comparisons (PL vs. CZ; types of education etc.)

### Load data
load(normalizePath("./../Data//MainData/finalData.RData"))
data <- fulldat

### Load packages
library(RColorBrewer)
library(lattice)
library(latticeExtra)
library(survival)
library(car)
library(doBy)
library(effsize)
library(heplots)
library(car)
library(psych)
library(sandwich)
library(mvtnorm)
library(TH.data)
library(multcomp)
### Load plotting functions
source(normalizePath("./../R_scripts/Visualization/PlottingFunctions.R"))
### Load processing tools
source(normalizePath("./../R_scripts//data_processing/processingTools.R"))
### Load V4 color theme
source(normalizePath("./../R_scripts//Visualization/Themes/LatticeThemes.R"))
V4bgw <- V4themes("standard_bgw")
```

# Descriptive statistics for knowledge and attitudes
Below we provide numerical summaries for the Liberalism-Socialism scale and the raw and non-guessed knowledge scores in terms of mean and positional parameters (quartiles and deciles).

## Descriptives for the Joint Sample

### Mean and quartiles
```{r, echo=FALSE}
summary(data[, c("libsoc", "ngknow", "knowraw")])
```

### Deciles
```{r, echo=FALSE}
lapply(data[, c("libsoc", "ngknow", "knowraw")], quantile, na.rm=TRUE,
       probs=seq(0, 1, .1))
```

## Descriptives by country

### Mean and quartiles
```{r, echo=FALSE}
lapply(data[, c("libsoc", "ngknow", "knowraw")],
       function(x) tapply(x, data$country, summary))
```

### Deciles
```{r, echo=FALSE}
lapply(data[, c("libsoc", "ngknow", "knowraw")],
       function(x) tapply(x, data$country, quantile, na.rm=TRUE, probs=seq(0, 1, .1)))
```

## Descriptives by education type (EBMF, SSHA and STEM)

### Mean and quartiles
```{r, echo=FALSE}
lapply(data[, c("libsoc", "ngknow", "knowraw")],
       function(x) tapply(x, data$eduprog3, summary))
```

### Deciles
```{r, echo=FALSE}
lapply(data[, c("libsoc", "ngknow", "knowraw")],
       function(x) tapply(x, data$eduprog3, quantile, na.rm=TRUE, probs=seq(0, 1, .1)))
```

## Descriptives by education type and country

### Mean and quartiles
```{r, echo=FALSE}
lapply(data[, c("libsoc", "ngknow", "knowraw")],
       function(x) tapply(x, interaction(data$eduprog3, data$country), summary))
```

### Deciles
```{r, echo=FALSE}
lapply(data[, c("libsoc", "ngknow", "knowraw")],
       function(x) tapply(x, interaction(data$eduprog3, data$country), quantile,
                          na.rm=TRUE, probs=seq(0, 1, .1)))
```

# Analysis of the KNOWLEDGE items set
Now we turn to the analysis of the KNOWLEDGE items set. We will partition it into subsets of easy, medium and tricky items and check whether items orderings in regard to difficulty levels are the same in different subgroups.

For this purpose we will inspect numerical values of difficulty levels (difficulty of an item is of course the fraction of respondents giving the correct answer) and visualize this data using dotplots with 95% Agresti-Coul confidence intervals.

```{r, echo=FALSE}
kdata <- data[, grep("^k[0-9]+|country|eduprog3", names(data), perl=TRUE)]
kdat <- kdata[, grep("^k[0-9]+", names(kdata), perl=TRUE)]
```

## KNOWLEDGE items set in the Joint Sample
```{r, echo=FALSE, fig.width=5, fig.height=5, fig.align='center'}
### Joint sample
### Items difficulties with 95% Agresti-Coul confidence intervals
diffPlot <- plotBinary(kdat, ci=TRUE, reverse=TRUE, vline=TRUE, alpha=.05)
diffPlot <- update(diffPlot, xlab="Item Difficulty", par.settings=V4bgw)
diffPlot
```

We see from the plot that items may be partitioned (according to our rule) in the following way:

```{r, echo=FALSE}
### Numerical summary
diffOrd <- round(sort(sapply(kdat, 
                             function(x) 1 - mean(x, na.rm=TRUE)), decreasing=TRUE), 3)
JointSubsets <- list(tricky=names(diffOrd)[1:7], medium=names(diffOrd)[8:10],
                     easy=names(diffOrd)[11:29])
JointSubsets
```

Below we provide numerical values for the difficulties and their confidence intervals:

```{r, echo=FALSE}
JointFrame <- dlevelFrame(kdat)
round(JointFrame, 3)
```

## Knowledge scores and type of education
```{r, echo=FALSE}
### Education type
### EBMF
EBMFplot <- plotBinary(kdat[kdata$eduprog3=="EBMF", ], ci=TRUE, reverse=TRUE, vline=TRUE)
EBMFplot <- update(EBMFplot, xlab="Item Difficulty", par.settings=V4bgw)
EBMFord <- round(sort(sapply(kdat[kdata$eduprog3=="EBMF", ], 
                             function(x) 1 - mean(x, na.rm=TRUE)), decreasing=TRUE), 3)

### SSHA
SSHAplot <- plotBinary(kdat[kdata$eduprog3=="SSHA", ], ci=TRUE, reverse=TRUE, vline=TRUE)
SSHAplot <- update(SSHAplot, xlab="Item Difficulty", par.settings=V4bgw)
SSHAord <- round(sort(sapply(kdat[kdata$eduprog3=="SSHA", ], 
                             function(x) 1 - mean(x, na.rm=TRUE)), decreasing=TRUE), 3)

### STEM
STEMplot <- plotBinary(kdat[kdata$eduprog3=="STEM", ], ci=TRUE, reverse=TRUE, vline=TRUE)
STEMplot <- update(STEMplot, xlab="Item Difficulty", par.settings=V4bgw)
STEMord <- round(sort(sapply(kdat[kdata$eduprog3=="STEM", ], 
                             function(x) 1 - mean(x, na.rm=TRUE)), decreasing=TRUE), 3)
```

### EBMF students
```{r, echo=FALSE, fig.width=5, fig.height=5, fig.align='center'}
EBMFplot
```

### SSHA students
```{r, echo=FALSE, fig.width=5, fig.height=5, fig.align='center'}
SSHAplot
```

### STEM students
```{r, echo=FALSE, fig.width=5, fig.height=5, fig.align='center'}
STEMplot
```

## Knowledge scores and country

### Polish students
```{r, echo=FALSE, fig.width=5, fig.height=5, fig.align='center'}
### PL
PLplot <- plotBinary(kdat[kdata$country=="PL", ], ci=TRUE, reverse=TRUE, vline=TRUE)
PLplot <- update(PLplot, xlab="Item Difficulty", par.settings=V4bgw)
PLord <- round(sort(sapply(kdat[kdata$country=="PL", ], 
                             function(x) 1 - mean(x, na.rm=TRUE)), decreasing=TRUE), 3)
PLSubsets <- list(tricky=names(PLord)[1:5], medium=names(PLord)[6:11],
                     easy=names(PLord)[12:29])
PLFrame <- dlevelFrame(kdat[kdata$country=="PL", ])
PLplot
```

We see from the plot that items may be partitioned (according to our rule) in the following way:

```{r, echo=FALSE}
PLSubsets
```

Below we provide numerical values for the difficulties and their confidence intervals:

```{r, echo=FALSE}
round(PLFrame, 3)
```

### Czech students
```{r, echo=FALSE, fig.width=5, fig.height=5, fig.align='center'}
### CZ
CZplot <- plotBinary(kdat[kdata$country=="CZ", ], ci=TRUE, reverse=TRUE, vline=TRUE)
CZplot <- update(CZplot, xlab="Item Difficulty", par.settings=V4bgw)
CZord <- round(sort(sapply(kdat[kdata$country=="CZ", ], 
                           function(x) 1 - mean(x, na.rm=TRUE)), decreasing=TRUE), 3)
CZSubsets <- list(tricky=names(CZord)[1:7], medium=names(CZord)[8:10],
                  easy=names(CZord)[11:29])
CZFrame <- dlevelFrame(kdat[kdata$country=="CZ", ])
CZplot
```

We see from the plot that items may be partitioned (according to our rule) in the following way:

```{r, echo=FALSE}
CZSubsets
```

Below we provide numerical values for the difficulties and their confidence intervals:

```{r, echo=FALSE}
round(CZFrame, 3)
```

Before moving to the next part of the analysis it would be good to compare items partitioning in the Joint Sample and Polish and Czech samples.

```{r, echo=FALSE}
cat("Joint Sample\n")
JointSubsets

cat("PL Sample\n")
PLSubsets

cat("CZ Sample\n")
CZSubsets
```

Clearly some items do overlap in different groups, but not all of them.

# Associations analysis
In this section we will examine various associations between knowledge scores and the Liberalism-Socialism axis as well as parental education, work experience and type of education.

## Liberalism-Socialism amongst Polish and Czech students
We begin with an analysis of the differences in regard to the Liberalism-Socialism scale scores between Polish and Czech students. We see that the distributions are slightly different - the Polish one is more spread out and shifted a bit more in the direction of liberalism; however both have means above zero, that is on the 'socialist' side of the scale.

```{r, echo=FALSE, fig.width=4, fig.height=4, fig.align='center'}
bwplot(libsoc ~ country, data=data, par.settings=V4bgw, ylab="Liberalism-Socialism")
summaryBy(libsoc ~ country, data=data, FUN=c(mean, sd), na.rm=TRUE)
```

Formal test show that indeed Polish students are closer to the midpoint of the scale, while Czechs gravitate more to the side of socialism. Although the effect is significant its magnitude is rather small (as Cohen's $d$ coefficients shows).

```{r, echo=FALSE}
t.test(libsoc ~ country, data=data, var.equal=FALSE)
cohen.d(libsoc ~ country, data=data, pooled=TRUE)
```

## Knowledge scores in the Polish and Czech samples
In this case distributions are very similar (since non-guessed score is a function of raw score we show charts only for the non-guessed).

```{r, echo=FALSE, fig.width=4, fig.height=4, fig.align='center'}
### No difference
bwplot(ngknow ~ country, data=data, par.settings=V4bgw,
       ylab="Non-guessed knowledge score")
summaryBy(ngknow + knowraw ~ country, data=data, 
          FUN=c(mean, sd), na.rm=TRUE)
```

Formal tests also prove that there is no significant difference in this regard between the samples.

```{r, echo=FALSE}
lapply(data[, c("ngknow", "knowraw")],
       function(x) t.test(x ~ data$country, var.equal=FALSE))
lapply(data[, c("ngknow", "knowraw")],
       function(x) cohen.d(x ~ data$country, pooled=TRUE))
```

## Liberalism-Socialism and education type
Now we compare education type groups (EBMF, SSHA and STEM) in a context of the Liberalism-Socailism scale scores. It is easy to see that EBMF group is shifted towards liberalism, while SSHA tends to have stronger socialist attitudes. The STEM group is between and closie to the midpoint.

```{r, echo=FALSE, fig.width=4, fig.height=4, fig.align='center'}
bwplot(libsoc ~ eduprog3, data=data, par.settings=V4bgw, ylab="Liberalism-Socialism")
summaryBy(libsoc ~ eduprog3, data=data, 
          FUN=c(mean, sd), na.rm=TRUE)[1:3, ]
```

A formal test (ANOVA) shows that education type matters and that about 5.7% of the variance of the Liberalism-Socialism scale scores is associated with it. Moreover EBMF mean is not significantly greater than 0 (the scale's midpoint) and both STEM and SSHA groups have higher (more socialist) means than it - although this effect is stronger in the SSHA group.

```{r, echo=FALSE}
summary(lm(libsoc ~ eduprog3, data=data))
```

## Knowledge scores and education type
Without a doubt the EBMF group have much higher scores. On average EBMF students gave almost 10 correct answers without guessing while STEM students gave about 5 and SSHA students below 3.

```{r, echo=FALSE, fig.width=4, fig.height=4, fig.align='center'}
bwplot(ngknow ~ eduprog3, data=data, par.settings=V4bgw,
       ylab="Non-guessed knowledge score")
summaryBy(ngknow + knowraw ~ eduprog3, data=data, 
          FUN=c(mean, sd), na.rm=TRUE)[1:3, ]
```

19.3% of variance of the knowledge scores is associated with the effect of education type and both STEM and SSHA groups have significanly lower means than the EBMF group.

```{r, echo=FALSE}
summary(lm(ngknow ~ eduprog3, data=data))
```

## Liberalism-Socialism and OIJPE
Numerical values show that there is some variation in the group means, however it is hard to say whether it is something more than noise. The line on the plot depicts the linear regression model that tries to predict group means assuming that the relationship between the Liberalism-Socialism scale scores nad the OIJPE values is close to linear.

```{r, echo=FALSE, fig.width=6, fig.height=5, fig.align='center'}
bwplot(libsoc ~ peduord, data=data, par.settings=V4bgw, ylab="Liberalism-Socialism",
       xlab="Ordinal Indicator of Joint Parental Education", horizontal=FALSE,
       panel=function(...) {
             panel.bwplot(...)
             panel.abline(a=.70271, b=-.09216, lty=3, lwd=2, col="gray11")
             panel.text(x=1.5, y=-.1, labels="y = 0.70 - 0.09x", col="red3")
             })
summaryBy(libsoc ~ peduord, data=data, 
          FUN=c(mean, sd), na.rm=TRUE)[1:7, ]
```

A formal test shows that there is no significant relationship between the Liberalism-Socialism scale scores and the OIJPE scores.

```{r, echo=FALSE}
summary(lm(libsoc ~ peduord, data=data))
```

## Liberalism-Socialism and father education
Distributions in the groups suggest no strong association.

```{r, echo=FALSE, fig.width=6, fig.height=5, fig.align='center'}
bwplot(libsoc ~ father_edu, data=data, par.settings=V4bgw, ylab="Liberalism-Socialism",
       xlab="Father Education", horizontal=FALSE)
summaryBy(libsoc ~ father_edu, data=data, 
          FUN=c(mean, sd), na.rm=TRUE)[1:4, ]
```

A formal test confirms this supposition. There is no significant relationship between the variables.

```{r, echo=FALSE}
summary(lm(libsoc ~ father_edu, data=data))
```

## Liberalism-Socialism and mother education
In this case it seems that the higher mother education is the more centrist attitudes a child has.

```{r, echo=FALSE, fig.width=6, fig.height=5, fig.align='center'}
bwplot(libsoc ~ mother_edu, data=data, par.settings=V4bgw, ylab="Liberalism-Socialism",
       xlab="Mother Education", horizontal=FALSE)
summaryBy(libsoc ~ mother_edu, data=data, 
          FUN=c(mean, sd), na.rm=TRUE)[1:4, ]
```

However, formal testing does not confirm this.

```{r, echo=FALSE}
summary(lm(libsoc ~ mother_edu, data=data))
```

## Knowledge scores and OIJPE
Distributions suggest that there is no clear relationship with the OIJPE scores.

```{r, echo=FALSE, fig.height=5, fig.width=6, fig.align='center'}
bwplot(ngknow ~ peduord, data=data, ylab="Non-guessed KNOWLEDGE Scores",
       xlab="Ordinal Joint Parental Education Indicator", horizontal=FALSE,
       par.settings=V4bgw)
summaryBy(ngknow + knowraw ~ peduord, data=data, 
          FUN=c(mean, sd), na.rm=TRUE)[1:7, ]
```

Formal testing confirms this.

```{r, echo=FALSE}
summary(lm(ngknow ~ peduord, data=data))
```

## Knowledge scores and father education
Again distributions show no pattern.

```{r, echo=FALSE, fig.width=6, fig.height=5, fig.align='center'}
bwplot(ngknow ~ father_edu, data=data, ylab="Non-guessed KNOWLEDGE Scores",
       xlab="Father Education", horizontal=FALSE,
       par.settings=V4bgw)
summaryBy(ngknow + knowraw ~ father_edu, data=data, 
          FUN=c(mean, sd), na.rm=TRUE)[1:4, ]
```

And formal testing confirms it too.

```{r, echo=FALSE}
summary(lm(ngknow ~ father_edu, data=data))
```

## Knowledge scores and mother education
No clear pattern in distributions.

```{r, echo=FALSE, fig.width=6, fig.height=5, fig.align='center'}
bwplot(ngknow ~ mother_edu, data=data, ylab="Non-guessed KNOWLEDGE Scores",
       xlab="Mother Education", horizontal=FALSE,
       par.settings=V4bgw)
summaryBy(ngknow + knowraw ~ mother_edu, data=data, 
          FUN=c(mean, sd), na.rm=TRUE)[1:4, ]
```

Formal testing shows that indeed there is no association between the variables.

```{r, echo=FALSE}
summary(lm(libsoc ~ mother_edu, data=data))
```

## Knowledge scores and the Liberalism-Socialism scale
Now we turn to the problem of the relationship between the knowledge scores and the Liberalism-Socialism scale scores. Simple correlation coefficient indicates that there may be some sort of an association. The negative value of the coefficient shows that the negative pole of the Liberalism-Socialism scale (that is liberalism) is related to better knowledge scores.

```{r, echo=FALSE}
lowerCor(data[, c("libsoc", "ngknow")])
```

Regression model shows that indeed there is significant relationship of such kind; Liberalism-Socialism scale scores are associated with 6.9% of the variance of the knowledge scores and on average the stronger liberal attitude of a person is, the better knowledge score he or she gets. According to the model equation (see the plot below) a person with a score of -5 on the Liberalism-Socialism (quite strong liberal attitude) axis would give about 10 nonrandom correct answers, while a person with a score of 5 (quite strong socialist attitude) on the axis would give only about 2 nonrandom correct answers.

```{r, echo=FALSE, fig.width=7, fig.height=6, fig.align='center'}
summary(lm(ngknow ~ libsoc, data=data, subset=knowIV==0))
xyplot(ngknow ~ libsoc, data=data, par.settings=V4bgw, xlab="Liberalism-Socialism",
       ylab="Non-guessed KNOWLEDGE score", panel=function(x, y, ...) {
             panel.xyplot(x, y, ..., grid=TRUE)
             panel.ablineq(lm(y ~ x), r.sq=TRUE, rot=TRUE, lwd=2, lty=2, col="black",
                           digits=2, offset=1, at=.15, pos=3)
       })
```

### Knowledge scores and the Liberalism-Socialism scale while controlling for country
Now we extends the model in order to control for the effect of a country, since the dynamics of this relationship may differ between Poland and Czech Republic. Correlation coefficients in countries suggest that the effect may be weaker in amongst Czech students.

```{r, echo=FALSE}
### Controlling for country
cat("Polish sample")
lowerCor(data[data$country=="PL", c("libsoc", "ngknow")])
cat("Czech sample")
lowerCor(data[data$country=="CZ", c("libsoc", "ngknow")])
```

Formal test indeed showed that there is a significant effect of an interaction between country and liberalism-socialism, which cause the effect in the Polish sample to be more than two times stronger than the corresponding effect in the Czech sample. In the Polish sample 10.5% of the variance of the knowledge scores is associated with the liberalism-socialism scale scores, while in the Czech sample it is only 3.5%. In the Joint Sample it is 7.8%.

```{r, echo=FALSE, fig.width=7.5, fig.height=7}
summary(lm(ngknow ~ libsoc*country, data=data, subset=knowIV==0))
summary(lm(ngknow ~ libsoc, data=data, subset=knowIV==0 & country=="PL"))
summary(lm(ngknow ~ libsoc, data=data, subset=knowIV==0 & country=="CZ"))
xyplot(ngknow ~ libsoc | country, data=data, par.settings=V4bgw,
       xlab="Liberalism-Socialism", ylab="Non-guessed KNOWLEDGE score",
       layout=c(1,2), panel=function(x, y, ...) {
             panel.xyplot(x, y, ..., grid=TRUE)
             panel.ablineq(lm(y ~ x), r.sq=TRUE, rot=TRUE, lwd=2, lty=2, col="black",
                           digits=2, offset=1, at=.15, pos=3)
       })
```

### Knowledge scores and the Liberalism-Socialism scale while controlling for education type
Correlation coefficients in group suggest that the relationship is much stronger in the EBMF group.

```{r, echo=FALSE}
### Controlling for type of education
cat("EBMF")
lowerCor(data[data$eduprog3=="EBMF", c("libsoc", "ngknow")])
cat("SSHA")
lowerCor(data[data$eduprog3=="SSHA", c("libsoc", "ngknow")])
cat("STEM")
lowerCor(data[data$eduprog3=="STEM", c("libsoc", "ngknow")])
```

Formal test confirms that there is an interaction between education type and liberalism-socialism scores. The model parameters show that in this case the interaction means that in the EBMF group association between liberalims-socialism scoresn and knowledge scores is much stronger (in SSHA group it is even non-existent - see the equations on the plot). The model with interaction explains about 22.7% of the variance (fractions of variance explained in the subgroup are on the plot).

```{r, echo=FALSE, fig.width=7.5, fig.height=7}
summary(lm(ngknow ~ libsoc*eduprog3, data=data, subset=knowIV==0))
xyplot(ngknow ~ libsoc | eduprog3, data=data, par.settings=V4bgw,
       xlab="Liberalism-Socialism", ylab="Non-guessed KNOWLEDGE score",
       layout=c(1,3), panel=function(x, y, ...) {
             panel.xyplot(x, y, ..., grid=TRUE)
             panel.ablineq(lm(y ~ x), r.sq=TRUE, rot=TRUE, lwd=2, lty=2, col="black",
                           digits=2, offset=1, at=.15, pos=3)
       })
```

## Liberalism-Socialism and work experience
Group means clearly show that respondents with no work experience on average have a little bit stronger socialist attitudes. There is also a difference, although much smaller between up to 1 year of experience and more.

```{r, echo=FALSE, fig.width=5, fig.height=4, fig.align='center'}
### Boxplots for the libsoc scale
bwplot(libsoc ~ work_experience, data=data, par.settings=V4bgw,
       ylab="Liberalism-Socialism", xlab="Work Experience", horizontal=FALSE)
summaryBy(libsoc ~ work_experience, data=data, 
          FUN=c(mean, sd), na.rm=TRUE)[1:3, ]
```

We test statistical significance of this observation using an ANOVA model with contrasts. The first contrast test wheter the first group (no experience) has higher mean of Liberalism-Socialism than the other two groups on average. The second contrast test whether the two groups of people with experience do differ.

```{r, echo=FALSE}
### Anovas
data$wexp <- factor(data$work_experience, ordered=FALSE)
### Test of linear constrasts:
### I (wexp1) : no experience vs. up to 1 year and 1 year+ toghether
### II (wexp2) : up to 1 year vs. 1year+
### Intercept in the model corresponds to the average of cell means
mat <- matrix(c(1/3,1/3,1/3,
                1,-1/2,-1/2,
                0,1,-1), 3, 3)
mymat <- solve(t(mat))
contrasts(data$wexp) <- mymat[, 2:3]
summary(lm(libsoc ~ wexp, data=data))
```

We see that the first contrast (wexp1 in the output table) is significant and that the second one is not. Therefore we conclude that students who have work experience have slightly weaker socialist attitudes (the model retains about 1.5% of the variance of the liberalism-socialism scores).

We also checked whether there are differences in regard to this effect between the countries. We found out that it is not the case - interaction effect is not significant. Although median positions suggest that the effect is more vivid in Poland (see the plot). However, due to the lack of a formal proof of the significance, we will make no further inquiries into it.

```{r, echo=FALSE, fig.width=7, fig.height=5, fig.align='center'}
### Controlling for country
bwplot(libsoc ~ work_experience | country, data=data, par.settings=V4bgw,
       ylab="Liberalism-Socialism", xlab="Work Experience", horizontal=FALSE,
       layout=c(2, 1))
anova(lm(libsoc ~ wexp * country, data=data)) # No interaction effect
```


## Knowledge scores and work experience
Again we see that people with no work experience tend to have lower scores on average than those with some experience. The difference between the other two groups is much smaller and probably not significant.

```{r, echo=FALSE, fig.width=5, fig.height=4, fig.align='center'}
bwplot(ngknow ~ work_experience, data=data, ylab="Non-guessed KNOWLEDGE Scores",
       xlab="Work Experience", horizontal=FALSE,
       par.settings=V4bgw)
summaryBy(ngknow + knowraw ~ wexp, data=data, 
          FUN=c(mean, sd), na.rm=TRUE)[1:3, ]
```

We test significance of this observation with a linera model with contrasts analogous to the ones from the previous section. And yet again we see that the first one is significant (so students with no work experience tend to have lower knowledge scores), while the second one is not (there is no difference between those with up to 1 year of experience and those with more). The model retains about 1.3% of the variance of the knowledge scores.

```{r, echo=FALSE}
### Test of linear constrasts:
### I (wexp1) : no experience vs. up to 1 year and 1 year+ toghether
### II (wexp2) : up to 1 year vs. 1year+
### Intercept in the model corresponds to the average of cell means
mat <- matrix(c(1/3,1/3,1/3,
                1,-1/2,-1/2,
                0,1,-1), 3, 3)
mymat <- solve(t(mat))
contrasts(data$wexp) <- mymat[, 2:3]
summary(lm(ngknow ~ wexp, data=data))
contrasts(data$wexp) <- contr.treatment(3)
contrasts(data$work_experience) <- contr.treatment(3)
```

Additionaly we tested the difference between the countries. We found that the interaction effect is nearly significant (plots in groups also suggest interaction by which knowledge of Czech students grows with the experience, while knowledge of Polish students grow with the first year of experience and then suddenly diminishes; however we have to leave the question of whether this is a true effect or just noise unanswered due to the lack of formal significance).

```{r, echo=FALSE, fig.width=7, fig.height=5, fig.align='center'}
bwplot(ngknow ~ work_experience | country, data=data, par.settings=V4bgw,
       ylab="Non-guessed KNOWLEDGE Scores", xlab="Work Experience", horizontal=FALSE,
       layout=c(2, 1))
anova(lm(ngknow ~ wexp * country, data=data))
```

## Knowledge and liberlism-socialism scores and study year
Now we look at the influence of time spent at university on the knowledge scores and the liberalism-socialism dimension. Correlation tests prove that there is significant association only in the case of the knowledge scores. Therefore we will analyze further only this variable.

```{r, echo=FALSE}
data$uniyear <- as.numeric(data$year_at_uni)
corr.test(data[, c("libsoc", "ngknow", "uniyear")])
```

However, we found that at level of the entire sample only about 1% of the variance of the knowledge scores is explained by study year.

```{r, echo=FALSE, fig.width=7.5, fig.height=6, fig.align='center'}
xyplot(ngknow ~ uniyear, data=data, par.settings=V4bgw,
       xlab="Study year", ylab="Non-guessed KNOWLEDGE score",
       layout=c(1,1), panel=function(x, y, ...) {
             panel.xyplot(x, y, ..., grid=TRUE)
             panel.ablineq(lm(y ~ x), r.sq=TRUE, rot=TRUE, lwd=2, lty=2, col="black",
                           digits=2, offset=1, at=.85, pos=3)
       })
summary(lm(ngknow ~ uniyear, data=data))
```

We also conditioned this effect on type of education, since it may be an important factor in this case. However, we found that there is no significant interaction effect - at level of the entire sample there is no significant differences in this regard.

```{r, echo=FALSE, fig.width=7, fig.height=6, fig.align='center'}
anova(lm(ngknow ~ uniyear*eduprog3, data=data))
```

This lack of effect may stem from other differences, that is differences between countries. Thus we tested also three-way interaction with country. We found that there is indeed a significant three-way interaction effect.

```{r, echo=FALSE, fig.width=7.5, fig.height=7.5, fig.align='center'}
### Controling for type of education and country
anova(lm(ngknow ~ uniyear*eduprog3*country, data=data))
### Now we have an interaction between uniyear, country and type of education
xyplot(ngknow ~ uniyear | country + eduprog3, data=data, par.settings=V4bgw,
       xlab="Study year", ylab="Non-guessed KNOWLEDGE score",
       layout=c(2,3), panel=function(x, y, ...) {
             panel.xyplot(x, y, ..., grid=TRUE)
             panel.ablineq(lm(y ~ x), r.sq=TRUE, rot=TRUE, lwd=2, lty=2, col="black",
                           digits=2, offset=1, at=.70, pos=3)
       })
```

Inspection of the plots show that there is something very interesting going on here. It seems that only Czech students gain more knowledge (mostly EBMF and STEM students) with subsequent years of studies, while Polish students do not (STEM students get even worse).

Formal test of models in the subgroups showed that there are only two groups that have positive association between knowledge scores and study year and these are EBMF and STEM students in Czech Republic.

```{r, echo=FALSE}
### Models in the subgroups
for(edu in levels(data$eduprog3)) {
      for(cntry in levels(data$country)) {
            cat(sprintf("######\nGROUP : %s in %s\n######\n", edu, cntry))
            print(summary(lm(ngknow ~ uniyear, data=data,
                       subset = data$eduprog3==edu & data$country==cntry)))
      }
}
```

# Financial knowledge scores analysis
For the last part of the analysis we introduce another measure: financial knowledge scores. It is the same as the non-guessed knowledge scores but computed only for the subset of the knowledge items with strictly financial content (this was established by means of expert analysis of the items' content). This subset consists of the following items:

* There are 12 financial items: **k1**, **k2**, **k6**, **k8**, **k12**, **k13**, **k14**, **k18**, **k22**, **k25**, **k28**, **k30**

```{r, echo=FALSE}
finitems <- paste("k", c(1,2,6,8,12,13,14,18,22,25,28,30), sep="")
ngfinance <- apply(kdat[, finitems], 1, nonguessedKnowScore)
data$ngfinance <- ngfinance
```

We see that the distirbution of the scores is nicely symemtric and on average respondents gave a bit more than one nonrandom correct answer.

```{r, echo=FALSE, fig.width=5, fig.height=4, fig.align='center'}
histogram(~ngfinance, par.settings=V4bgw, xlab="Percent of Total",
          ylab="Non-guessed financial knowledge scores")
summary(ngfinance)
```

## Financial knowledge scale scores by country and education type

### By country
There is no significant difference in regard to group means between Poland and Czech Republic and the distributions are also very similar.

```{r, echo=FALSE}
## By country
tapply(data$ngfinance, data$country, summary) # similar, but not the same
t.test(ngfinance ~ country, data=data, var.equal=FALSE) 
```

### By education type
Tests show that both SSHA and STEM students have lower means than EBMF students.

```{r, echo=FALSE, fig.width=7, fig.height=5, fig.align='center'}
## By type of education
tapply(data$ngfinance, data$eduprog3, summary)
### We see that EBMF has highest scores and STEM is in the middle
bwplot(ngfinance ~ eduprog3, data=data, par.settings=V4bgw,
       ylab="Non-guessed financial knowledge scores")
summary(lm(ngfinance ~ eduprog3, data=data))
```

### By country and education type
The distributions in the subgroups are clearly different and there is also significant interaction effect of country and education type.

```{r, echo=FALSE, fig.width=7, fig.height=5, fig.align='center'}
### Helper categorical joint indicator of eduprog and country
data$edu3country <- interaction(data$eduprog3, data$country)
bwplot(ngfinance ~ edu3country, data=data, par.settings=V4bgw,
       ylab="Non-guessed financial knowledge scores")
anova(lm(ngfinance ~ country * eduprog3, data=data))
```

Model coefficients show that Polish EBMF students have the mean score (significantly better than Czech EBMF students) and at the same time that Polish SSHA and STEM students have lower mean scores than corresponding Czech students (it is easu to see that on the plot above).

```{r, echo=FALSE}
### There is significatn interaction
summary(lm(ngfinance ~ country * eduprog3, data=data))
```

## Financial knowledge scores and liberalism-socialism
There is general slight negative association between liberalism-socialism scale scores and financial knowledge scale scores (so the stronger socialist attitudes are, the lower financial scores are).

```{r, echo=FALSE}
anova(lm(ngfinance ~ libsoc * eduprog3, data=data))
```

### Financial knowledge scores and liberalism-socialism controling for education type and country
However, additional analyses proved that this effect is universal and does not interact with education type and country. In other words it stays more or less the same regardles of these two factors.

```{r, echo=FALSE}
### By country
### interaction effect
anova(lm(ngfinance ~ libsoc * country, data=data)) # notsignificant

### By education type and country
### 3-way interaction effect
anova(lm(ngfinance ~ libsoc * country * eduprog3, data=data))
### no 3-way and no 2-way interactions with liberalism-socialism
```

## Financial knowledge scores and study year
There is also a (slight) general association between financial knowledge scores and study year.

```{r, echo=FALSE, fig.width=7, fig.height=6, fig.align='center'}
xyplot(ngfinance ~ uniyear, data=data, par.settings=V4bgw,
       xlab="Study year", ylab="Non-guessed KNOWLEDGE score",
       layout=c(1,1), panel=function(x, y, ...) {
             panel.xyplot(x, y, ..., grid=TRUE)
             panel.ablineq(lm(y ~ x), r.sq=TRUE, rot=TRUE, lwd=2, lty=2, col="black",
                           digits=2, offset=1, at=.85, pos=3)
       })
summary(lm(ngfinance ~ uniyear, data=data))
```

### Financial knowledge scores and study year controling for education type and country
There is significant 3-way interaction between study year, contry and education type (see the plot below that depicts it very well). It implies that the association between financiel knowledge scores and study year varies between student groups in Poland and Czech Republic.

```{r, echo=FALSE, fig.width=7.5, fig.height=7, fig.align='center'}
### Controling for country and education type
xyplot(ngfinance ~ uniyear | country + eduprog3, data=data, par.settings=V4bgw,
       xlab="Study year", ylab="Non-guessed KNOWLEDGE score",
       layout=c(2,3), panel=function(x, y, ...) {
             panel.xyplot(x, y, ..., grid=TRUE)
             panel.ablineq(lm(y ~ x), r.sq=TRUE, rot=TRUE, lwd=2, lty=2, col="black",
                           digits=2, offset=1, at=.70, pos=3)
       })
anova(lm(ngfinance ~ uniyear * country * eduprog3, data=data))
### There are significant interaction between country and eduprog and 3-way interaction of this two factors and study year
```

Analysis of the models (financial knowledge vs. study year) in the subgroups (education type $\times$ country) gives inconclusive results. For three groups (SSHA students in Poland and Czech Republic and EBMF students in Czech Republic) it is rather certain that  there are no association between financial knowledge and study year. For the others (EBMF in Poland and STEM in both Poland and Czech Republic) the assocaition is very close to being significant (see the outputs below). It means that we rather can not rule out that there may be a positive association between financial knowledge and study year in amongst Polish EBMF studenst and Czech STEM students. Surprisngly enough we also can not rule out that there is a negative association between the variables in the group of Polish STEM students.

```{r, echo=FALSE}
### Models in the subgroups
for(edu in levels(data$eduprog3)) {
      for(cntry in levels(data$country)) {
            cat(sprintf("######\nGROUP : %s in %s\n######\n", edu, cntry))
            print(summary(lm(ngfinance ~ uniyear, data=data,
                             subset = data$eduprog3==edu & data$country==cntry)))
      }
}
```